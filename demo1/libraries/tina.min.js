!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.tina=n()}(this,function(){"use strict";var t=Object.prototype.toString,n=function(n){var e;return"[object Object]"===t.call(n)&&(null===(e=Object.getPrototypeOf(n))||e===Object.getPrototypeOf({}))},e=function(t,n){for(var e={},r=Object.keys(t),o=r.length,a=0;a<o;a++){var i=r[a];e[i]=n(i,t[i])}return e};var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")},a=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),i=function(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t},u=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},c=function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n)},f=function(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?t:n},s=function(){return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,n){var e=[],r=!0,o=!1,a=void 0;try{for(var i,u=t[Symbol.iterator]();!(r=(i=u.next()).done)&&(e.push(i.value),!n||e.length!==n);r=!0);}catch(t){o=!0,a=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw a}}return e}(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=function(t){if(Array.isArray(t)){for(var n=0,e=Array(t.length);n<t.length;n++)e[n]=t[n];return e}return Array.from(t)};function p(t){var n={};return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).forEach(function(e){e in t&&(n[e]=t[e])}),n}function d(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.filter(function(t){return-1===n.indexOf(t)})}function h(t){return Object.keys(t).map(function(n){return t[n]})}function y(){var t={};return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(n){var e=s(n,2),r=e[0],o=e[1];return t[r]=o}),t}var v={App:App,Page:Page,Component:Component,wx:wx},g=function(t,n){return Array.isArray(t)?t.concat(n):"object"===(void 0===t?"undefined":r(t))?u({},t,n):n},b=function(){function t(){o(this,t)}return a(t,[{key:"setData",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=this.adapters.data,o=r.isData,a=r.fromPlainObject,i=r.merge,u=r.diff,c=r.toPlainObject;t=o(t)?t:a(t);var f=i(this.data,t);if("function"==typeof this.compute){var s=this.compute(f);f=i(f,s=o(s)?s:a(s))}var l=c(u(f,this.data));if(n(l)||console.warn("[Tina] - The data which is passed to MINA should be a plain object, please check your DataAdaptor-class."),this.constructor.log("setData",l),this.data=f,function(t){if(null==t)return!0;if(t.length>0)return!1;if(0===t.length)return!0;for(var n in t)if(hasOwnProperty.call(t,n))return!1;return!0}(l))return e();this.$source.setData(l,e)}}],[{key:"mixin",value:function(t){this._mixins.push(t)}},{key:"mix",value:function(t,n){var r=this;return Array.isArray(n)?n.reduce(function(t,n){return r.mix(t,n)},t):"function"==typeof n?this.mix(t,n(t,this)):u({},t,e(n,function(n,e){return g(t[n],e)}))}},{key:"log",value:function(t,n){this.debug&&console.log("[Tina."+this.name+"] - "+t+(n?": ":""),n)}}]),t}();b.debug=!1,b._mixins=[];var m=function(t,n){for(var e={},r=Object.keys(t),o=r.length,a=0;a<o;a++){var i=r[a];n(i,t[i])&&(e[i]=t[i])}return e};var _=function(t,n){return function(t,n){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={},o=function(o){r[o]=function(){for(var r=arguments.length,a=Array(r),i=0;i<r;i++)a[i]=arguments[i];e&&n[o].apply(this,a),"function"==typeof t[o]&&t[o].apply(this,a),e||n[o].apply(this,a)}};for(var a in n)o(a);return u({},t,r)}(t,n,!0)};function O(t){var n=t.TargetClass,e=t.getSourceInstance;return t.properties.forEach(function(t){Object.defineProperty(n.prototype,t,{set:function(n){e(this)[t]=n},get:function(){var n=e(this),r=n[t];return"function"==typeof r?r.bind(n):r}})}),n}function j(t,n,o){var a=t.isData,i=t.fromPlainObject,u=t.merge;(n=a(n)?n:i(n),"object"===(void 0===o?"undefined":r(o)))&&(n=u(n,i(e(m(o,function(t,n){return"object"===(void 0===n?"undefined":r(n))&&void 0!==n.value}),function(t,n){return n.value}))));return n}function P(){this.setData(),this.$log("Initial Mixin","Ready")}var w={attached:P,onLoad:P};function k(){this.$log=this.constructor.log.bind(this.constructor),this.$log("Log Mixin","Ready")}var x={created:k,beforeLoad:k};function A(t){return e(t||{},function(t,n){return function(){for(var n=this.__tina_instance__,e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];return n[t].apply(n,r)}})}function D(t,n){return y(t.map(function(t){var e=n(t);return[t,function(){var n=this.__tina_instance__;if(e&&n[e]&&n[e].apply(n,arguments),n[t])return n[t].apply(n,arguments)}]}))}var S=function(t,n){n=n||10;var e=[],r="",o=RegExp;return function t(a,i){i>n||"function"!=typeof a&&void 0!==a&&("object"!=typeof a||!a||a instanceof o?r+=a:-1===e.indexOf(a)&&i!==n&&(e.push(a),r+="{",Object.keys(a).forEach(function(n,e,o){if("_"!==n.charAt(0)){var u=typeof a[n];"function"!==u&&"undefined"!==u&&(r+=n,t(a[n],i+1))}})))}(t,0),r};var $=Object.prototype.hasOwnProperty,E=function(t,n,e){!function(t,n,e){for(var r in t)if(!1===n.call(e,t[r],r,t))break}(t,function(r,o){if($.call(t,o))return n.call(e,t[o],o,t)})};function R(t,n,e){throw new Error('[Tina] - The method "'+t+'" of DataAdaptor should be overrided by a function, which receives arguments <('+n.join(", ")+")> and return <"+e+">.")}var T=function(){function t(){o(this,t)}return a(t,null,[{key:"isData",value:function(t){R("isData",["data"],"Boolean()")}},{key:"fromPlainObject",value:function(t){R("fromPlainObject",["plain"],"data")}},{key:"merge",value:function(t,n){R("merge",["original","extra"],"data")}},{key:"diff",value:function(t,n){R("diff",["original","extra"],"data")}},{key:"toPlainObject",value:function(t){R("diff",["data"],"plain")}}]),t}(),C=function(){function t(n){var e=this;o(this,t),E(n,function(t,n){e[n]=t}),Object.defineProperty(this,"__signatures",{enumerable:!1,writable:!0}),this.sign()}return a(t,[{key:"sign",value:function(){this.__signatures=e(this,function(t,n){return S(n)})}},{key:"signature",value:function(t){return this.__signatures[t]}},{key:"isDirty",value:function(t){var n=this;return t?!(!this[t]&&!this.__signatures[t])&&this.__signatures[t]!==S(this[t]):Object.keys(this).some(function(t){return n.isDirty(t)})}}]),t}(),L=function(t){function n(){return o(this,n),f(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return c(n,T),a(n,null,[{key:"isData",value:function(t){return t instanceof C}},{key:"fromPlainObject",value:function(t){return new C(t)}},{key:"merge",value:function(t,n){return new C(u({},t,n))}},{key:"diff",value:function(t,n){return new C(m(t,function(e,r){return r!==n[e]||t.signature(e)!==n.signature(e)}))}},{key:"toPlainObject",value:function(t){return e(t,function(t,n){return n})}}]),n}(),I=["data","onLoad","onReady","onShow","onHide","onUnload","onPullDownRefresh","onReachBottom","onShareAppMessage","onPageScroll"],B=["onLoad","onReady","onShow","onHide","onUnload","onPullDownRefresh","onReachBottom","onShareAppMessage","onPageScroll"],M={onLoad:"beforeLoad"},U=["data"].concat(B),H=[].concat(B,l(h(M))),N=u({mixins:[],data:{},compute:function(){}},y(H.map(function(t){return[t,[]]})),{methods:{},adapters:{data:L}}),Q=[x,w],q=function(t){function n(t){var r=t.options,a=void 0===r?{}:r;t.$source;o(this,n);var i=f(this,(n.__proto__||Object.getPrototypeOf(n)).call(this)),c=u({data:a.data,compute:a.compute||function(){return{}}},a.methods,e(p(a,H),function(t,n){return function(){for(var t=this,e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];return n.reduce(function(n,e){return e.apply(t,r.concat(n))},void 0)}}),{adapters:a.adapters});for(var s in c)i[s]=c[s];return f(i,i)}return c(n,b),a(n,null,[{key:"define",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(t=this.mix(N,[].concat(Q,l(this._mixins),l(t.mixins||[]),[t]))).data=j(t.adapters.data,t.data);var e=u({data:t.adapters.data.toPlainObject(t.data)},A(t.methods),D(B.filter(function(n){return t[n].length>0}),function(t){return M[t]}));e=_(e,{onLoad:function(){var e=new n({options:t,$source:this});this.__tina_instance__=e,e.$source=this}}),new v.Page(u({},p(t,d(I,U)),e))}}]),n}();q._mixins=[],O({TargetClass:q,getSourceInstance:function(t){return t.$source},properties:[].concat(l(d(["data","route"],["data"])),l(d(["setData"],["setData"])))});var z=["properties","data","methods","behaviors","created","attached","ready","moved","detached","relations","options"],F=["created","attached","ready","moved","detached"],G={},J=["properties","data","methods"].concat(F),K=[].concat(F,l(h(G))),V=u({mixins:[],behaviors:[],properties:{},data:{},compute:function(){}},y(K.map(function(t){return[t,[]]})),{methods:{},relations:{},options:{},adapters:{data:L}}),W=[x,w],X=function(t){function n(t){var r=t.options,a=void 0===r?{}:r;t.$source;o(this,n);var i=f(this,(n.__proto__||Object.getPrototypeOf(n)).call(this)),c=u({data:a.data,compute:a.compute||function(){return{}}},a.methods,e(p(a,K),function(t,n){return function(){for(var t=this,e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];return n.reduce(function(n,e){return e.apply(t,r.concat(n))},void 0)}}),{adapters:a.adapters});for(var s in c)i[s]=c[s];return f(i,i)}return c(n,b),a(n,null,[{key:"define",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(t=this.mix(V,[].concat(W,l(this._mixins),l(t.mixins||[]),[t]))).data=j(t.adapters.data,t.data,t.properties);var o=u({data:t.adapters.data.toPlainObject(t.data),properties:function(t){function n(t,n){return function(){for(var e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];var a=r[0],u=this.__tina_instance__,c=this.__tina_instance__.adapters.data.fromPlainObject;return u.setData(c(i({},t,a))),"string"==typeof n?u[n].apply(u,r):"function"==typeof n?n.apply(u,r):void 0}}return e(t||{},function(t,e){return"function"==typeof e||null===e?{type:e,observer:n(t)}:"object"===(void 0===e?"undefined":r(e))?u({},e,{observer:n(t,e.observer)}):void 0})}(t.properties),methods:A(t.methods)},D(F.filter(function(n){return t[n].length>0}),function(t){return G[t]}));o=_(o,{created:function(){var e=new n({options:t,$source:this});this.__tina_instance__=e,e.$source=this}}),new v.Component(u({},p(t,d(z,J)),o))}}]),n}();X._mixins=[],O({TargetClass:X,getSourceInstance:function(t){return t.$source},properties:[].concat(l(d(["is","id","dataset","data"],["data"])),l(d(["setData","hasBehavior","triggerEvent","createSelectorQuery","selectComponent","selectAllComponents","getRelationNodes"],["setData"])))});var Y=function(t){function e(){return o(this,e),f(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return c(e,T),a(e,null,[{key:"isData",value:function(t){return n(t)}},{key:"fromPlainObject",value:function(t){return t}},{key:"merge",value:function(t,n){return u({},t,n)}},{key:"diff",value:function(t,n){return m(t,function(t,e){return e!==n[t]})}},{key:"toPlainObject",value:function(t){return t}}]),e}(),Z=function(){function t(){o(this,t)}return a(t,null,[{key:"use",value:function(t){if(~this._plugins.indexOf(t))return this;if("function"==typeof t.install){for(var n=arguments.length,e=Array(n>1?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];t.install.apply(t,[this].concat(e))}return this._plugins.push(t),this}}]),t}();return Z.Unit=b,Z.Page=q,Z.Component=X,Z.BasicDataAdapter=T,Z.PlainDataAdapter=Y,Z.SigmundDataAdapter=L,Z._plugins=[],Z});